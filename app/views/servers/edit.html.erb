<%= yield(:head) %>
<% content_for :head do %>
<script type="text/javascript">
   $(document).ready(function(){
     var availableContacts = <%= raw Contact.populate_contacts(current_user, params[:id]) %>;
     $('#contact').typeahead({

        source: function (query, process) {
          names = [];
          map = {};
     

          $.each(availableContacts, function (i, name) {
            var q=name.name +"  \""+name.email+"\"";
            map[q] = name;
            names.push(q);
          });
          process(names);
        },

        updater: function (item) {
          $('#hidden_id').val(map[item].id);
          return item;
        }
      });

     $('#new_contact_link').click(function(){
       $('#new_contact_div').toggle();
     });

   });
  </script>
 <% end %> 

<legend>Editing server</legend>

<div id="two_forms">

<div id="left_form" style="width: 300px;float: left;">
<%= render 'form' %>
</div>
<div id="right_form" style="margin-left: 60px;float: right">
  <label for="contacts">Contacts: </label>
  <%= form_tag contacts_servers_assign_path, class:'form-search' do %>
  <%= hidden_field_tag(:hidden_id) %>
  <div class="input-append">
  <input id="contact" data-provide="typeahead" autocomplete="off" class="span3 search-query" />
  <%= submit_tag "Add", class:'btn btn-success' %>
  </div>
  <% end %>

  <%= link_to('New Contact', 'javascript:;', id:'new_contact_link') %>

  <div id="new_contact_div" style="display:none" >
    <%= form_tag('/contacts', remote:true, id:'form2') do %>
    <%= label_tag 'name' %>
    <%= text_field_tag 'name' %><br />
    <%= label_tag 'email' %>
    <%= text_field_tag 'email' %><br />
    <%= hidden_field_tag 'status', 'ajax_call' %>
    <%= hidden_field_tag 'server_id', @server_id %>
    <%= submit_tag 'Add This Contact', class:'btn btn-success' %>
    <% end %>

  <!--  <%= render partial:'contacts/form', object:@contact %>  --> 
  </div>
</div>  
</div>
<div id="already_added_contacts" style="margin-top: 300px">
   <%= render 'contacts' %>
</div>  
<br />
<!--
<%= link_to 'Show', @server %> |
<%= link_to 'Back', servers_path %> -->



